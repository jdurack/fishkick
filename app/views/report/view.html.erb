<% content_for :head do %>
  <%= javascript_include_tag 'report' %>
<% end %>

<% content_for :description do %>
  <%= @site.name %> fishing report for <%= Date.today.strftime("%A %B %-d, %Y") %>.  Find the latest fishing conditions, including recent reports, FishKick fish scores, USGS stream flow data, weather data, photos, location map, fish seasonality, recommended fishing gear, similar sites, and more.
<% end %>


<% unless @site %>
  <h4>Site not found</h4>
  <a href='/'>Go back</a>
<% else %>

  <% content_for :title do %>
    <%= @site.name %> Fishing Report
  <% end %>

  <div class='row'>

    <div class="pageSection">
      <div class="primaryImage overlayImage" data-image="<%= @site.primary_image %>">
        <h1 class="overlayText headerText left"><%= @site.name %> Fishing Report</h1>
        <h4 class="overlayText right"><%= Date.today.strftime("%A %B %-d, %Y") %></h4>
      </div>
    </div>

    <div class='col-md-10'>

      <!-- FishScores and Comments -->
      <div class='row pageSection'>
        <div class='col-md-3 fishScoreArea'>
          <div class='subheader'>Fish Scores</div>
          <%= render @site.fish_scores.sort_by {|fs| -fs.value} %>
        </div>
        <div class='col-md-9 reportCommentsArea'>
          <div class='subheader recentReports'>Recent Reports</div>
          <div class='addReportComment btn btn-default' data-toggle='modal' data-target='#addReportCommentModal'>add report</div>
          <%= render @site.report_comments.sort_by {|rc| rc.datetime}.reverse %>
        </div>
      </div>

      <!-- Add Report Comment Modal -->
      <div class="modal fade" id="addReportCommentModal" tabindex="-1" role="dialog" aria-labelledby="addReportCommentModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
              <h4 class="modal-title" id="addReportCommentModalLabel">Add a <%= @site.name %> fishing report</h4>
            </div>
            <div>
              <input type='hidden' id='addReportCommentSiteId' value="<%= @site.id %>" />
              <textarea id='addReportCommentComment'></textarea>
            </div>
            <div class="modal-footer addReportCommentModalFooter">
              <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
              <button type="button" class="btn btn-primary" data-dismiss="modal" id='addReportCommentSaveButton'>Save</button>
            </div>
          </div>
        </div>
      </div>


      <!-- Graphs -->
      <% if @site.hasUSGSData() or @site.hasWeatherData() %>
        <div class='row pageSection'>
          <!-- USGS Data -->
          <div class='col-md-6'>
            <% if @site.hasUSGSData() %>
              <%= render 'usgs_data', locals: {site: @site} %>
            <% end %>
          </div>

          <!-- Weather -->
          <div class='col-md-6'>
            <% if @site.hasWeatherData() %>
              <%= render 'weather_data', locals: {site: @site} %>
            <% end %>
          </div>
        </div>
      <% end %>

      <!-- SiteFishInfos -->
      <% if @site.hasActiveSiteFishInfos() %>
        <div class='row pageSection'>
          <div class='col-md-12'>
            <div class='subheader'>Seasonality</div>
            <%= render 'site_fish_infos', locals: {site_fish_infos: @site.site_fish_infos.sort_by {|sfi| sfi.fish.name} } %>
          </div>
        </div>
      <% end %>

      <!-- Description, photos, map -->
      <div class='row pageSection'>
        <div class='row'>
          <div class='col-md-12'>
            <div class='subheader'><%= @site.name %></div>
          </div>
        </div>
        <div class='row'>
          <div class='col-md-7'>
            <% if @site.description %>
              <div id='siteDescription'>
                <%= raw @site.description %>
              </div>
            <% end %>
          </div>
          <div class='col-md-5'>
            <% if @site.site_images.size() > 0 %>
              <div class='siteMediaBox'>
                <%= render 'site_image_carousel', locals: {site: @site} %>
              </div>
            <% end %>
            <% if @site.hasGeoData() %>
              <div class='siteMediaBox'>
                <%= render 'site_map', locals: {site: @site} %>
              </div>
            <% end %>
          </div>
        </div>
      </div>

    </div>

    <!-- Guides -->
    <div class='col-md-2'>
      <% if @guides.size() > 0 %>
        <div class='subheader'>Talk to a guide</div>
        <%= render @guides, locals: {site: @site} %>
      <% end %>
    </div>

  </div>
  

<% end %>

<%= javascript_tag do -%>
  window.FK.init()
<% end %>